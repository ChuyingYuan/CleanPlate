<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/flowbite@2.5.1/dist/flowbite.min.css"
      rel="stylesheet"
    />
    <link href="../css/styles.css" rel="stylesheet" />
    <title>Ingredient List - CleanPlate</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyB9lRTjct3qFR5TDDhTIauwc_9ERadI9Ls"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <!-- CSV parser -->
  </head>
  <body class="pt-10 sm:pt-24">
    <!-- Sticky Navigation Bar -->
    <nav
      class="bg-white fixed w-full z-20 top-0 start-0 border-b border-gray-200"
    >
      <div
        class="max-w-screen-xl flex flex-wrap items-center justify-between mx-auto p-4"
      >
        <a
          href="../html/index.html"
          class="flex items-center space-x-3 rtl:space-x-reverse"
        >
          <img src="../WEBSITE_LOGO.png" class="h-8" alt="Logo" />
          <span class="self-center text-2xl font-semibold whitespace-nowrap"
            >CleanPlate</span
          >
        </a>
        <div
          class="items-center justify-between hidden w-full md:flex md:w-auto md:order-1"
          id="navbar-sticky"
        >
          <ul
            class="flex flex-col p-4 md:p-0 mt-4 font-medium border border-gray-100 rounded-lg bg-gray-50 md:space-x-8 rtl:space-x-reverse md:flex-row md:mt-0 md:border-0 md:bg-white"
          >
            <li><a href="../html/index.html">Home</a></li>
            <li>
              <a href="../html/expiry-date-tracker.html">Expiry Tracker</a>
            </li>
            <li><a href="../html/recipe.html">Recipe</a></li>
            <li><a href="../html/notification.html">Notification</a></li>
            <li>
              <a href="../html/wasted-food-scale.html">Wasted Food Scale</a>
            </li>
            <li><a href="../html/dashboard.html">Dashboard</a></li>
          </ul>
        </div>
      </div>
    </nav>

    <!-- Main Content -->
    <main class="container mx-auto mt-2 px-4 sm:px-8 flex-grow">
      <div class="mx-auto mt-10 sm:mt-16 sm:px-8">
        <h1 class="text-2xl font-bold">Your Ingredients List</h1>
        <div id="ingredients-list-container" class="mt-4"></div>
      </div>

      <!-- Store Locations -->
      <h1>Store Locations</h1>
      <div id="map" style="height: 500px; width: 100%"></div>
    </main>

    <footer
      class="left-0 z-20 w-full p-4 bg-white border-t border-gray-200 shadow md:flex md:items-center md:justify-between"
    >
      <span class="text-sm text-gray-500 sm:text-center"
        >&copy; <span id="current-year"></span> CleanPlate All Rights
        Reserved.</span
      >
    </footer>

    <script>
      window.onload = function () {
        // Display recipes and their ingredients
        const recipesList =
          JSON.parse(localStorage.getItem("recipesList")) || [];
        const ingredientsListContainer = document.getElementById(
          "ingredients-list-container"
        );

        recipesList.forEach((recipe) => {
          const recipeContainer = document.createElement("div");
          recipeContainer.className = "mb-4";

          const recipeName = document.createElement("h3");
          recipeName.className = "text-xl font-bold";
          recipeName.textContent = recipe.name;

          const ingredientList = document.createElement("ul");
          ingredientList.className = "list-disc mt-2 px-8";

          recipe.ingredients.forEach((ingredient) => {
            const li = document.createElement("li");
            li.textContent = ingredient;
            ingredientList.appendChild(li);
          });

          recipeContainer.appendChild(recipeName);
          recipeContainer.appendChild(ingredientList);
          ingredientsListContainer.appendChild(recipeContainer);
        });

        // Set the current year in the footer
        const currentYear = new Date().getFullYear();
        document.getElementById("current-year").textContent = currentYear;
      };

      // Initialize Google Maps and plot store locations
      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 12,
          center: { lat: -37.8136, lng: 144.9631 }, // Melbourne CBD
        });

        // Fetch and parse the CSV file
        fetch("grocery_store_locations.csv") // Adjust the path to the CSV file
          .then((response) => response.text())
          .then((csvData) => {
            Papa.parse(csvData, {
              header: true,
              complete: function (results) {
                const data = results.data;
                console.log("Parsed CSV Data:", data); // Check CSV data

                // If no data, log an error
                if (!data || data.length === 0) {
                  console.error("No data found in the CSV");
                  return;
                }

                data.forEach((store) => {
                  // Parse latitude and longitude
                  let lat = parseFloat(store.latitude);
                  let lng = parseFloat(store.longitude);

                  // Ensure lat and lng are valid numbers
                  if (isNaN(lat) || isNaN(lng)) {
                    console.error("Invalid coordinates for store:", store);
                    return;
                  }

                  // Use the correct column name for the type of store
                  let type = store["Industry (ANZSIC4) description"];
                  let markerColor;

                  // Determine marker color based on store type
                  if (type === "Supermarket and Grocery Stores") {
                    markerColor =
                      "http://maps.google.com/mapfiles/ms/icons/red-dot.png";
                  } else if (type === "Fruit and Vegetable Retailing") {
                    markerColor =
                      "http://maps.google.com/mapfiles/ms/icons/blue-dot.png";
                  } else if (
                    type === "Fresh Meat, Fish and Poultry Retailing"
                  ) {
                    markerColor =
                      "http://maps.google.com/mapfiles/ms/icons/green-dot.png";
                  } else {
                    console.warn("Unknown store type:", type); // Warn if store type is not recognized
                  }

                  // Place marker if the type is recognized and coordinates are valid
                  if (markerColor) {
                    new google.maps.Marker({
                      position: { lat: lat, lng: lng },
                      map: map,
                      icon: markerColor,
                      title: store.name || "Unknown Store",
                    });
                  }
                });
              },
            });
          })
          .catch((error) => {
            console.error("Error fetching or parsing CSV:", error);
          });
      }

      // Initialize the map when the page loads
      window.addEventListener("load", initMap);
    </script>
  </body>
</html>
